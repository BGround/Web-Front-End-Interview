《浏览器工作原理与实践》这个专栏，系统学习浏览器,把网络、页面、渲染、JavaScript、浏览器安全知识串联起来。

[浏览器工作原理知识图](https://github.com/BGround/Web-Front-End-Interview/blob/main/BrowserWork/README.md)

### 目录
- [1.Chrome架构:仅仅打开了1个页面,为什么有4个进程？](#1-Chrome架构)
- [2.UDP协议,TCP和HTTP协议](#2-UDP协议-TCP和HTTP协议)
- [3.Http请求详解关于cache和cookie](#3-Http请求详解关于cache和cookie)
- 
- 
- 
- 
- 
- 
- 
- 
- 
- 
- 
- 
- 
- 
- 
- 
- 
- 
- 
- 
- 
- 
- 



#### 1. Chrome架构
**线程 VS 进程**

多线程可以并行处理任务，但是**线程是不能单独存在的，它是由进程来启动和管理的。**
那什么又是进程呢？**一个进程就是一个程序的运行实例。**详细解释就是，启动一个程序的时候，操作系统会为该程序创建一块内存，用来存放代码、运行中的数据和一个执行任务的主线程，我们把这样的一个运行环境叫进程。

发展过程
早期单进程架构
不稳定
不流畅
不安全
早期多进程架构：主进程，渲染进程（渲染引擎webkit），插件进程
现代多进程架构：主进程，渲染进程（webkit改成了blink），插件进程，GPU进程，网络进程
未来：面向服务架构

思考题：
(1)多进程架构中，我偶尔还会碰到一些由于单个页面卡死最终崩溃导致所有页面崩溃的情况，请问这是什么原因呢?
(2)单进程浏览器开多个页面，渲染线程也只有一个吗？感觉一个页面开一个线程不是更合理吗？
(3)如果打开了 2个页面，会有几个进程呢？是 1 个网络进程、1 个浏览器进程、1 个 GPU 进程以及 2个渲染进程，共 5个吗？这些进程是可以在浏览器开发者中被实际观察到的吗？

**[:arrow_up: 返回目录](#目录)**

### 2. UDP协议 TCP和HTTP协议
**UDP：把数据包送达应用程序**
IP 是非常底层的协议，只负责把数据包传送到对方电脑，但是对方电脑并不知道把数据包交给哪个程序，是交给浏览器还是交给王者荣耀？
因此，需要基于 IP 之上开发能和应用打交道的协议，最常见的是“用户数据包协议（User Datagram Protocol）”，简称 UDP。
UDP 中一个最重要的信息是端口号，端口号其实就是一个数字，每个想访问网络的程序都需要绑定一个端口号。
通过端口号 UDP 就能把指定的数据包发送给指定的程序了，所以 IP 通过 IP 地址信息把数据包发送给指定的电脑，而 UDP 通过端口号把数据包分发给正确的程序。和 IP 头一样，端口号会被装进 UDP 头里面，UDP 头再和原始数据包合并组成新的 UDP 数据包。UDP 头中除了目的端口，还有源端口号等信息。
![UDP传输](https://static001.geekbang.org/resource/image/3e/ea/3edb673a43f23d84253c52124ce447ea.png)

**TCP：把数据完整地送达应用程序**
TCP（Transmission Control Protocol，传输控制协议）是一种面向连接的、可靠的、基于字节流的传输层通信协议
![一个TCP连接生命周期](https://static001.geekbang.org/resource/image/44/44/440ee50de56edc27c6b3c992b3a25844.png)

**HTTP协议**
HTTP协议和TCP协议都是TCP/IP协议簇的子集。

HTTP协议属于应用层，TCP协议属于传输层，HTTP协议位于TCP协议的上层。

请求方要发送的数据包，在应用层加上HTTP头以后会交给传输层的TCP协议处理，应答方接收到的数据包，在传输层拆掉TCP头以后交给应用层的HTTP协议处理。建立 TCP 连接后会顺序收发数据，请求方和应答方都必须依据 HTTP 规范构建和解析HTTP报文。

**[:arrow_up: 返回目录](#目录)**

### 3. Http请求详解关于cache和cookie
关于Http请求参照下面的流程图
![Http请求](https://static001.geekbang.org/resource/image/1b/6c/1b49976aca2c700883d48d927f48986c.png)

*(1)为什么通常在第一次访问一个站点时，打开速度很慢，当再次访问这个站点时，速度就很快了？*
>主要是第二次加载页面的过程中，缓存了一些耗时的数据，如DNS缓存和页面资源缓存。DNS缓存是浏览器本地把对应的IP和域名关联起来

>页面资源缓存是浏览器缓存数据到本地,当服务器返回HTTP响应头给浏览器时，浏览器是通过响应头中的Cache-control字段来设置是否
>缓存该资源，并用Max-age参数设置一个缓存过期时长，缓存资源未过期会直接返回缓存中的资源给浏览器，过期的话浏览器会继续发起网络请求
>并在HTTP请求头带上If-None-Match:"4f80f-13c-3a1xb12a",服务器收到请求头后，会根据 If-None-Match 的值来判断请求的资源是否有更新。
>如果没有更新，就返回 304 状态码，相当于服务器告诉浏览器：“这个缓存可以继续使用，这次就不重复发送数据给你了。”如果资源有更新，服务器就直接返回最新资源给浏览器。

![页面资源缓存](https://static001.geekbang.org/resource/image/5f/08/5fc2f88a04ee0fc41a808f3481287408.png)

*(2)登录状态是如何保持的？*


![Set-cookie](https://static001.geekbang.org/resource/image/d9/b3/d9d6cefe8d3d6d84a37a626687c6ecb3.png)

*(3)如果一个页面的网络加载时间过久，你是如何分析卡在哪个阶段的？*
>1 首先猜测最可能的出问题的地方，网络传输丢包比较严重，需要不断重传。然后通过ping curl看看对应的时延高不高。
>2 然后通过wireshake看看具体哪里出了问题。
>3 假如别人访问很快，自己电脑很慢，就要看看自己客户端是否有问题了

**[:arrow_up: 返回目录](#目录)**




